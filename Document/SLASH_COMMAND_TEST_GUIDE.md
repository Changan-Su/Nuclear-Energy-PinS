# 斜杠命令功能测试指南

## 快速测试步骤

### 1. 启动服务器

```bash
cd server
npm start
```

确保服务器在 `http://localhost:3000` 运行。

### 2. 打开编辑模式

1. 打开浏览器访问 `http://localhost:3000`
2. 点击右上角的 "Edit Mode" 按钮

### 3. 测试 '/' 命令触发

1. 滚动到任意有翻转卡片的区域 (如 Highlights, Features, Safety)
2. 点击卡片上的 "Learn more" 按钮,翻转到背面
3. 点击 detail 文本区域 (应该有蓝色边框表示可编辑)
4. 输入 `/` 字符
5. **预期结果**: 弹出命令菜单,显示 "Insert Image" 和 "Insert Video" 两个选项

### 4. 测试图片插入

1. 在命令菜单中,用鼠标点击或按 Enter 选择 "Insert Image"
2. 在文件选择器中选择一张图片 (jpg, png, gif 等)
3. **预期结果**: 
   - 右下角出现 "Uploading..." 提示
   - 上传完成后,图片出现在 detail 内容底部
   - 图片居中显示,默认宽度约 600px

### 5. 测试视频插入

1. 再次输入 `/`
2. 选择 "Insert Video"
3. 选择一个视频文件 (mp4, webm 等)
4. **预期结果**: 
   - 视频出现在底部
   - 视频居中显示,默认宽度约 800px
   - 视频有播放控件

### 6. 测试调整大小

1. 鼠标悬停在插入的图片或视频上
2. **预期结果**: 右侧出现蓝色的调整把手
3. 按住鼠标左键,拖拽调整把手左右移动
4. **预期结果**: 
   - 媒体块宽度实时变化
   - 最小宽度 200px,最大宽度 1200px
5. 松开鼠标
6. **预期结果**: 新宽度自动保存

### 7. 测试删除媒体

1. 鼠标悬停在媒体块上
2. **预期结果**: 右上角出现红色的 X 删除按钮
3. 点击删除按钮
4. **预期结果**: 媒体块被移除

### 8. 测试保存和重新加载

1. 点击工具栏的 "Save All" 按钮
2. 刷新页面
3. 翻回到之前编辑的 detail 区域
4. **预期结果**: 插入的媒体仍然存在,宽度保持不变

### 9. 测试键盘导航

1. 输入 `/` 打开命令菜单
2. 按 ↓ 箭头键
3. **预期结果**: 选中第二个命令 (Insert Video)
4. 按 ↑ 箭头键
5. **预期结果**: 返回第一个命令
6. 按 Esc
7. **预期结果**: 命令菜单关闭

## 可测试的区域

### Highlights (标签内容)
- 路径: 首屏向下滚动,第二个区域
- 有多个 tab,每个 tab 都有 detail

### Features (功能卡片)
- 路径: Highlights 下方
- 每个卡片的 "Learn more" 都有 detail

### Safety (安全性)
- 路径: Features 下方
- 点击 "Learn more" 翻转查看 detail

### Innovation (创新)
- 路径: Safety 下方
- 深色背景区域

### Economy (经济性)
- 路径: Innovation 下方
- 浅色背景区域

### Closer Look (近距离观察)
- 路径: Economy 下方
- 左侧列表项可能有 "Learn more" 按钮 (如果启用了 flip)

## 常见问题排查

### 问题: 输入 '/' 没有反应
- **检查**: 是否在编辑模式?
- **检查**: 是否点击了 detail 文本区域? (应该有光标闪烁)
- **检查**: 浏览器控制台是否有错误?

### 问题: 上传失败
- **检查**: 服务器是否正常运行?
- **检查**: `/upload` 端点是否正常工作?
- **检查**: 文件大小是否过大?

### 问题: 拖拽调整大小没反应
- **检查**: 是否在编辑模式?
- **检查**: 鼠标是否悬停在媒体块上? (应该显示蓝色把手)
- **检查**: 是否按住了鼠标左键拖动?

### 问题: 删除按钮不显示
- **检查**: 是否在编辑模式?
- **检查**: 鼠标是否悬停在媒体块上?

## 高级测试

### 测试向后兼容
1. 找一个已有的 detail (只有文本,没有 detailBlocks)
2. 插入一张图片
3. **预期结果**: 原有文本转换为 text 块,图片添加为 image 块

### 测试数据结构
1. 插入图片后,打开浏览器开发者工具
2. 在 Console 中输入: `window.ModeManager.getMaterial()`
3. 查找包含 `detailBlocks` 的字段
4. **预期结构**:
```javascript
{
  detailBlocks: [
    { type: 'text', content: '原有文本...' },
    { type: 'image', url: '/uploads/xxx.jpg', width: 600 }
  ]
}
```

## 已知限制提醒

1. ⚠️ 目前只能在 detail 末尾插入媒体,不能在文本中间
2. ⚠️ 插入媒体后,原 detail 文本会变成 text 块,暂不支持编辑
3. ⚠️ 如果服务器重启,已上传的文件可能丢失 (取决于服务器配置)

## 成功标准

- ✅ '/' 命令能正常触发
- ✅ 可以上传图片和视频
- ✅ 媒体显示正常,居中对齐
- ✅ 可以拖拽调整大小
- ✅ 可以删除媒体
- ✅ 保存后重新加载数据正常
- ✅ 键盘导航正常工作
