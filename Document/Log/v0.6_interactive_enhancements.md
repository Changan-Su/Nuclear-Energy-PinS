# Version 0.6 Development Log - Interactive Enhancements

## 开发时间
2026-02-12

## 版本目标
三项核心功能增强：
1. "Learn More" 按钮卡片翻转动画 + 详情编辑
2. 图片位置调整和缩放控制
3. LaTeX 数学公式渲染支持

## 功能一：卡片翻转动画（Learn More）

### 需求
- Highlights 区域中每个标签页的 "Learn More" 按钮，点击后应展示对应的详细内容
- 翻转动画需要符合 Apple 官网风格（流畅的 3D 翻转）
- 详情内容在编辑模式下可直接编辑

### 实现方案

**CSS 3D 翻转**:
- 使用 `perspective: 1200px` + `transform: rotateY(180deg)` 实现纵向翻转效果
- 过渡曲线 `cubic-bezier(0.4, 0.0, 0.2, 1)` 提供 Apple 风格的流畅感
- `backface-visibility: hidden` 确保正反面互不干扰

**DOM 结构调整**:
- 每个 tab content 内部包裹一个 `.flip-card` 容器
- 正面 `.flip-card-front`：原有内容（图片+标题+描述+按钮）
- 反面 `.flip-card-back`：详情内容（标题+分割线+详情文字+关闭按钮）

**数据层**:
- `material.json` 每个 highlight tab 新增 `detail` 字段，存储详情文本
- 详情文本支持 LaTeX 语法（配合功能三）

**交互逻辑**:
- 点击 "Learn More" 按钮 → `.flip-card` 添加 `.flipped` 类 → 触发 CSS 翻转
- 点击关闭按钮（X）→ 移除 `.flipped` 类 → 翻回正面
- 事件绑定在 `section-renderer.js` 的 `initializeFlipCards()` 中

### 文件变更
- `js/templates.js` — `tabbedContentTemplate()` 重构，增加翻转卡片结构
- `css/input.css` — 新增 `.flip-card`, `.flip-card-inner`, `.flip-card-front`, `.flip-card-back` 样式
- `material.json` — 每个 highlight tab 增加 `detail` 字段（含 LaTeX 示例内容）
- `js/section-renderer.js` — 新增 `initializeFlipCards()` 函数

---

## 功能二：图片位置与缩放控制

### 需求
- 编辑模式下，所有背景图片支持调整 X/Y 位置和缩放比例
- 调整参数持久化到 material 数据中
- 视图模式下控件隐藏

### 实现方案

**控件设计**:
- 底部居中的 floating 控制条（Apple 风格毛玻璃效果）
- 三个 range slider：X（0-100%）、Y（0-100%）、Zoom（50-300%）
- Reset 按钮恢复默认值（50%, 50%, 100%）

**数据结构**:
- 在 `images` 对象下新增 `position` 子对象：`{ x: 50, y: 50, scale: 100 }`
- 对于 card-grid 模板，使用 `imagePosition` 字段

**实时预览**:
- `input` 事件 → 实时更新 `background-position` 和 `background-size`
- `change` 事件 → 持久化到 material 数据

**CSS 可见性**:
- `.img-position-controls` 默认 `display: none`
- `body.edit-mode .img-position-controls` → `display: flex`

### 模板适配
所有带 `data-material-img` 的模板均已适配：
- Hero template（视频封面）
- Tabbed content template（高亮图片）
- Card grid template（卡片图片）
- Text-image-left / text-image-right（文图组合）
- Accordion template（closer look 图片）

### 文件变更
- `js/templates.js` — 所有模板函数增加 `imgPos` 解析逻辑，使用 `background-size: ${scale}%` 和 `background-position: ${x}% ${y}%`
- `js/section-renderer.js` — 新增 `initializeImagePositionControls()`, `applyImagePosition()`, `saveImagePosition()`, `getNestedValue()`, `setNestedValue()` 函数
- `css/input.css` — 新增 `.img-position-controls` 样式系统（毛玻璃背景、range slider 自定义主题、reset 按钮）

---

## 功能三：LaTeX 数学公式渲染

### 需求
- 文本内容支持 LaTeX 语法的数学公式显示
- 兼容行内公式 `$...$` 和独立公式 `$$...$$`
- 支持 `\(...\)` 和 `\[...\]` 语法

### 实现方案

**KaTeX 集成**:
- 引入 KaTeX v0.16.11（CDN）：CSS + JS + auto-render 插件
- 使用 `defer` 加载，不阻塞页面渲染

**渲染模块** (`js/latex-renderer.js`):
- `renderAll()`: 渲染页面中所有 `[data-material]` 和 `.latex-content` 元素中的 LaTeX
- `renderElement(el)`: 渲染指定元素
- `renderString(text)`: 将包含 LaTeX 的字符串转换为 HTML
- 自动等待 KaTeX 加载完成（轮询机制，最多 5 秒）

**Delimiter 配置**:
```javascript
delimiters: [
  { left: '$$', right: '$$', display: true },
  { left: '$', right: '$', display: false },
  { left: '\\(', right: '\\)', display: false },
  { left: '\\[', right: '\\]', display: true }
]
```

**集成点**:
- `section-renderer.js` 的 `reinitializeComponents()` 中调用 `LatexRenderer.renderAll()`
- 每次内容重渲染后自动触发 LaTeX 渲染

### 示例内容
material.json 中的 detail 字段已包含 LaTeX 示例：
- Efficiency: `$200\,\text{MeV}$`
- Zero Carbon: `$12\,\text{g CO}_2/\text{kWh}$`, `$820\,\text{g CO}_2/\text{kWh}$`
- Safety: `$1 \times 10^{-7}$`

### 文件变更
- `js/latex-renderer.js` — **新增文件**，LaTeX 渲染模块
- `index.html` — 引入 KaTeX CDN（CSS + JS + auto-render），加载 `latex-renderer.js`
- `js/section-renderer.js` — `reinitializeComponents()` 增加 `LatexRenderer.renderAll()` 调用

---

## 技术亮点

### 1. CSS 3D 翻转
- 使用纯 CSS 实现，无需 JS 动画库
- `transform-style: preserve-3d` 保持 3D 空间
- 适当的 `perspective` 值提供自然的深度感

### 2. 数据驱动的图片控制
- 位置/缩放参数存储在 material JSON 中，支持 undo/redo
- 实时预览 + 延迟保存的双轨策略

### 3. 惰性 LaTeX 渲染
- KaTeX 使用 defer 加载，不影响首屏渲染
- 渲染器内部有轮询等待机制，确保 KaTeX 就绪后才执行
- `throwOnError: false` 确保格式错误的公式不会破坏页面

## 文件变更清单

### 新增文件
- `js/latex-renderer.js` — LaTeX 渲染模块

### 修改的文件
- `js/templates.js` — 翻转卡片结构 + 图片位置参数支持
- `js/section-renderer.js` — 翻转卡片初始化 + 图片控制初始化 + LaTeX 渲染
- `css/input.css` — 翻转动画样式 + 图片控制条样式
- `index.html` — KaTeX CDN 引入 + latex-renderer.js 加载 + 内嵌数据更新
- `material.json` — highlight tabs 增加 detail 字段

### 更新的文档
- `Document/Log/v0.6_interactive_enhancements.md`（本文件）

## Bug修复 (2026-02-13)

### 问题：Grid Card 不显示
**症状**: Features 部分的三个卡片（Benefits 区域）在页面上不可见。

**根本原因**:
1. 在 `cardGridTemplate` 中，每个卡片被包裹在 `<div class="fade-in-up">` 中用于滚动动画
2. `fade-in-up` 类设置了 `opacity: 0` 和 `transform: translateY(20px)`
3. 外层 div 没有明确高度，导致：
   - 即使 flip-card 包装器设置了 `h-[560px]`，外层 div 可能崩塌为 0 高度
   - Intersection Observer 无法正确检测到元素进入视口
   - 动画未触发，卡片保持 `opacity: 0` 不可见

**修复方案**:
- 将 `h-[560px]` 高度类从内层 flip-card 包装器移到外层 `fade-in-up` div
- flip-card 包装器改用 `h-full` 继承父容器高度
- 移除 frontHtml 中冗余的 transition-delay（外层已有）

**修改文件**:
- `js/templates.js` — `cardGridTemplate()` 函数，调整高度分配逻辑

**技术要点**:
- CSS Intersection Observer 依赖元素的实际尺寸来判断是否进入视口
- 动画容器必须有明确的尺寸，否则会导致布局崩塌
- Tailwind 的 flex/grid 子项高度继承需要父容器有确定高度

---

## 参考的前置工作
- v0.5: SVG Template Gallery
- v0.4: Reference Citation System
- v0.3: CMS Online Editing System
- v0.2: Frontend Build
- v0.1: Initial Setup

---

## Bug修复 (2026-02-13) - 离线模式 Export/Import 失效

### 问题现象
- 离线模式点击 Export 会被直接拦截，无法导出当前编辑内容
- Import 在某些提前返回分支不会清空文件选择器，重复导入时看起来像“按钮无效”

### 根因分析
1. `exportMaterial()` 仅支持在线导出 ZIP 包，离线分支直接 `alert + return`
2. `handleImport()` 的 input reset 放在函数末尾；一旦在 `try` 内提前 `return`，重置逻辑不会执行

### 修复方案
- 为离线模式增加完整 ZIP 导出：
  - 读取当前 `ModeManager.getMaterial()`，构建 `site-package-YYYY-MM-DD.zip`
  - 导出内容包含 `index.html`、`material.json`、渲染脚本、样式以及可访问到的引用素材
- 为导入流程增加 `finally` 统一收口：
  - 无论导入成功、失败或提前返回，都会重置 `event.target.value`
  - 保证同一文件可重复触发导入
- 新增离线 ZIP 导入流程：
  - 解析包内 `material.json`
  - 将 `uploads/*` 文件转为 `data:` URL 并回填到 material，确保离线可直接显示

### 修改文件
- `js/editor.js`

---

## 功能修正 (2026-02-13) - 移动端竖屏保持横屏比例布局

### 问题现象
- 手机竖屏下页面会按窄屏断点重新排版，视觉比例与横屏设计偏差较大。
- 用户希望优先保持横屏视觉比例，允许在竖屏看到更长的纵向内容。

### 实现方案
1. **新增动态 viewport 管理器**
   - 在页面初始化时检测是否为移动端设备。
   - 当设备处于竖屏时，按 `16:9` 计算虚拟布局宽度：`width = max(960, innerHeight * 16/9)`。
   - 将 `meta viewport` 动态设置为该宽度，让浏览器对整体布局做等比缩放，尽量维持横屏版式比例。
2. **横屏与桌面保持原行为**
   - 移动端横屏、非移动端统一使用 `width=device-width`，避免影响桌面与常规横屏体验。
3. **方向变化实时更新**
   - 监听 `orientationchange`、`resize`、`pageshow`，保证旋转或回到页面时自动重算。

### 修改文件
- `js/viewport-manager.js`
- `Examples/js/viewport-manager.js`
- `index.html`
- `Examples/index.html`

---

## 功能增强 (2026-02-13) - Examples 首个 Tabbed Content 章节化填充（基于 section2 文档）

### 需求
- 按用户提供的 `nuclear individual section2.docx` 填充 `Examples` 目录中的首个 Tabbed Content 页面。
- 不同章节对应不同按钮，并自动对齐 `subtitle / Key Sentence / Details`。
- 尽可能保留原文，并将公式转换为可在站点中渲染的格式。

### 实现方案
1. **数据映射策略**
   - 目标模板采用 `highlights.items` 数据结构，实际字段为：
     - `tab`（按钮标题）
     - `title`（对应 subtitle）
     - `description`（对应 Key Sentence）
     - `detail`（对应 Details）
   - 将文档中的 5 个章节分别映射为 5 个 tab。

2. **章节拆分与按钮化**
   - 按原文章节结构拆分：
     - The Physics of Nuclear Fission
     - The Chain Reaction
     - How a Nuclear Reactor Controls Fission
     - Nuclear Fission in History and Safety
     - Future Fission Technologies
   - `tabs` 与 `items[].tab` 同步更新为章节按钮文案，保证前台切换一致。

3. **公式适配**
   - 依据现有 KaTeX 渲染链路（`$...$` / `$$...$$`），将关键公式写入 `detail`：
     - 典型裂变方程（U-235 示例）
     - 质能关系式 `E=mc^2`
     - 链式反应中 `k` 的概念表达式及 `$k<1$/$k=1$/$k>1$`
   - 兼容当前模板反面详情区的 `.latex-content` 渲染。

### 修改文件
- `Examples/material.json`

### 结果
- `Examples` 首个 Tabbed Content 已从原先 3 个占位项扩展为 5 个章节按钮。
- 每个章节已完成 `subtitle -> title`、`Key Sentence -> description`、`Details -> detail` 的自动对应填充。
- 关键公式已改为站点可渲染格式，保留原文语义并增强可读性。

---

## Bug修复 (2026-02-13) - Examples 页面未读取最新 material.json

### 问题现象
- 直接打开 `Examples/index.html` 后，页面仍显示旧内容，`Examples/material.json` 中的新章节数据未生效。

### 根因分析
1. `Examples/index.html` 内嵌了旧版 `window.__PRELOADED_MATERIAL__`。
2. 启动时 `SectionRenderer.init()` 直接使用内嵌对象渲染，绕过外部 `material.json`。

### 修复方案
- 调整初始化逻辑为：
  - 优先加载 `./material.json`（`fetch`，并禁用缓存）。
  - 若 `fetch` 在部分 `file://` 场景失败，则回退到 `XMLHttpRequest` 读取本地文件。
  - 仅当两者都失败时，才回退内嵌 `__PRELOADED_MATERIAL__`。

### 修改文件
- `Examples/index.html`

---

## Bug修复 (2026-02-13) - 生成到文件夹/ZIP 后仍可能读取旧内嵌数据

### 问题现象
- 通过离线保存（`Save All`）生成的站点目录，或离线 `Export ZIP` 生成的 `index.html`，在后续仅修改 `material.json` 时，页面可能仍显示旧内容。

### 根因分析
1. 生成器输出的 `index.html` 默认以 `window.__PRELOADED_MATERIAL__` 直接初始化渲染。
2. 外部 `material.json` 未作为首选数据源，导致“改 JSON 不生效”。

### 修复方案
- 对两条生成链路统一改造为：
  - 优先读取 `./material.json`（`fetch` + `no-store`）。
  - `file://` 场景下 `fetch` 失败时，自动回退到 `XMLHttpRequest`。
  - 两者都失败时才使用内嵌 `__PRELOADED_MATERIAL__` 兜底。
- 同步将离线 README 文案更新为“外部 material.json 为主，内嵌仅兜底”。

### 修改文件
- `js/offline-site-saver.js`
- `js/editor.js`

---

## 功能修正 (2026-02-13) - Examples 公式渲染、详情滚动与引用跳转完善

### 问题
- 部分公式在详情面板显示为未渲染文本/错误样式。
- 长详情文本在卡片反面可能超出可视区域，不便阅读。
- 章节内容中的参考文献未按项目引用格式接入，无法直接跳转到底部 Reference。

### 修复
1. **公式渲染稳定性**
   - 将高风险公式写法改为更稳的 KaTeX 表达（如裂变方程中的能量项改为 `Q`）。
   - 在 LaTeX 渲染器新增 `katex-error` 恢复逻辑：对常见转义问题进行归一化并二次渲染尝试。
2. **详情面板滚动**
   - Tabbed Content 反面详情容器改为固定区域内滚动（`latex-content` 强制 `overflow-y-auto` + `max-height:100%`）。
3. **引用系统接入**
   - 在章节 `detail` 中插入项目兼容引用标记：
     - `<sup class="ref-cite" data-ref-id="N">[N]</sup>`
   - 同步填充 `footer.reference.items` 为对应文献条目，支持点击引用平滑跳转并高亮 Reference。

### 修改文件
- `Examples/material.json`
- `Examples/js/templates.js`
- `Examples/js/latex-renderer.js`
- `js/templates.js`
- `js/latex-renderer.js`

---

## 功能增强 (2026-02-13) - Tabbed/Grid/Accordion 条目动态增减

### 需求
- `Tabbed Content` 支持增减 tab 按钮与对应内容项（不再固定 4 个）。
- `Grid Card` 支持增减 card 数量。
- `Accordion` 支持增减条目数量。
- 编辑模式下直接在模板区域完成操作，并保持 undo/redo 与保存链路一致。

### 实现方案
1. **Tabbed Content 数组化 + 旧结构兼容**
   - `tabbedContentTemplate()` 改为优先读取 `highlights.items` 数组。
   - 新增兼容转换：若 `items` 不存在，则从旧结构 `tabs + efficiency/zeroCarbon/safety/reliability` 生成运行时条目，保证旧数据可继续渲染。
   - 新路径统一为 `highlights.items.{index}.*`，内联编辑和 flip 配置均可直接写回数组结构。

2. **编辑模式内嵌集合控件**
   - 在 `editor.js` 新增集合编辑器逻辑：
     - `enableCollectionEditors()` / `disableCollectionEditors()`
     - `handleAddCollectionItem()` / `handleDeleteCollectionItem()`
   - 三类模板在编辑模式下新增：
     - `+ Add Tab`
     - `+ Add Card`
     - `+ Add Item`
   - 每个条目带独立删除按钮，且设置最小保留数量（至少 1 项）。
   - 所有增删都接入既有流程：`captureSnapshot -> updateMaterialInMemory -> render -> refresh`。

3. **默认数据与新增 Section 初始化**
   - 新增 `createDefaultCollectionItem()`，为 tab/card/accordion 定义可立即编辑的默认字段。
   - 新增 `createDefaultSectionData(template)`，保证通过 Add Section 创建这三类模板时，不会出现空模板。

4. **交互隔离与结构标记**
   - `section-renderer.js` 中 tab 切换改为 section 内作用域，避免全局 `.tab-content` 串扰。
   - 三类模板增加 `data-collection-*` 标记，供编辑器精确定位集合容器和条目节点。

### 兼容与修正说明
- 为避免历史内容丢失，旧的 highlights 四 key 结构仍保留读取兼容。
- 基线数据补充了 `highlights.items`（`index.html` 与 `material.json`），后续编辑将优先写入新结构。

### 修改文件
- `js/templates.js`
- `js/editor.js`
- `js/section-renderer.js`
- `index.html`
- `material.json`

### 修正说明
- 初版修复将离线 Export 处理为 JSON 下载，无法满足“完整可运行站点压缩包”目标。
- 已二次修正为离线导出 ZIP 包，结构与在线 package 导出保持一致（`index.html`、`material.json`、渲染脚本、样式与可读取素材）。
- 同时新增离线 ZIP 导入：读取 `material.json` 并将 `uploads/*` 媒体自动转为 `data:` URL 内嵌，确保离线可直接显示。

---

## Bug修复 (2026-02-13) - Hero 更换媒体后占位文案未隐藏

### 问题现象
- 在 Hero 区域替换图片或视频后，背景媒体已更新，但 `Video Background Placeholder` 文案仍然可见。

### 根因分析
1. `heroTemplate()` 中占位文案区域是固定渲染，未根据 `hero.images.videoCover` 是否有值进行条件隐藏。
2. 编辑模式中 `applyMediaPreview()` 只更新背景图/视频节点，不会同步切换占位文案显示状态。

### 修复方案
- 模板层修复（首次渲染场景）：
  - 在 `heroTemplate()` 新增 `hasHeroMedia` 判断。
  - 当存在媒体时，为占位容器添加 `hidden`，并加入 `data-hero-media-placeholder="true"` 标记。
- 编辑器实时修复（编辑中切换场景）：
  - 在 `editor.js` 新增 `syncHeroMediaPlaceholder()`。
  - `applyMediaPreview()` 在图片和视频分支都调用该函数，确保替换后立即隐藏占位文案，清空媒体时再恢复显示。

### 修改文件
- `js/templates.js`
- `js/editor.js`

---

## Bug修复 (2026-02-13) - 离线刷新后媒体丢失（文字仍在）

### 问题现象
- 离线编辑后刷新页面，文本改动仍可恢复，但图片/视频改动丢失。

### 根因分析
1. 离线草稿此前仅使用 `localStorage` 持久化。
2. 文本体积小，通常可成功写入；媒体在离线模式会被转为 `data:`（base64）后体积迅速膨胀。
3. 超出浏览器配额后会写入失败，导致刷新只能读取“上一次成功保存”的草稿，形成“文字在、媒体没了”。

### 修复方案
- 将离线草稿存储升级为 **IndexedDB 主存储**，并保留 `localStorage` 作为兜底。
- 启动时优先读取 IndexedDB；若仅存在旧 `localStorage` 草稿，会自动迁移到 IndexedDB。
- 离线保存失败时增加可见告警（`alert`），提示用户立即导出 ZIP 备份或切换在线上传媒体，避免静默丢失。
- 继续保留离线自动保存路径（编辑中实时写草稿）。

### 修改文件
- `js/mode-manager.js`
- `js/editor.js`

---

## Bug修复 (2026-02-13) - 离线导出缺少完整脚本和初始化逻辑

### 问题现象
- 离线模式导出的 ZIP 包打开后，前端显示不完整或部分功能异常。

### 根因分析
1. `getStaticPackageFiles()` 缺少 `mode-manager.js`、`editor.js`、`material.js`。
2. 导出 HTML 的脚本加载顺序和初始化逻辑与原 `index.html` 不一致。
3. 缺失的脚本导致部分依赖初始化链断裂（例如导航、滚动动画、AI 聊天等）。

### 修复方案
- 将 `mode-manager.js`、`editor.js`、`material.js` 加入静态打包清单。
- 调整导出 HTML 的脚本加载顺序，与原项目 `index.html` 保持一致。
- 初始化逻辑改为调用 `ModeManager.init()`（与原项目完全对齐）。

### 修改文件
- `js/editor.js`

---

## 功能增强 (2026-02-13) - 离线模式本地文件夹持久化

### 问题背景
- 离线模式使用 IndexedDB/localStorage 保存草稿,大文件(base64 媒体)会超出浏览器配额导致保存失败
- 用户无法直接访问保存的内容,只能通过导出 ZIP 才能获得完整站点
- 缺乏真正的本地文件系统持久化能力

### 需求
- 允许用户选择一个本地文件夹作为工作目录
- 保存时将完整站点(纯查看版)写入到文件夹
- 重新打开页面时自动从授权文件夹加载 material.json
- 实现真正的本地持久化,不受浏览器存储配额限制

### 实现方案

#### 技术选型
- 使用 **File System Access API** (Chrome 86+, Edge 86+)
- 用户首次保存时选择工作文件夹并授权
- 权限信息存储在 IndexedDB 中(仅存储句柄,不存储内容)

#### 架构设计

**工作流程**:
1. 用户在带编辑功能的 index.html 中编辑内容
2. 点击 "Save All" 按钮
3. 首次保存时弹出文件夹选择对话框
4. 将纯查看版站点写入到选定文件夹
5. 重新打开编辑器时,自动从文件夹加载 material.json
6. 继续编辑,保存时更新文件夹内容

**保存内容**:
- `index.html`: 纯查看版(无编辑器、无在线功能)
- `material.json`: 内容数据
- `uploads/`: 用户上传的媒体文件
- `css/styles.css`: 样式文件
- `js/`: 核心展示脚本(templates.js, section-renderer.js 等,但不包括 editor.js, mode-manager.js)
- `README.txt`: 使用说明

**数据处理**:
- 自动提取 `data:` URL 并转换为实际文件
- 规范化路径(绝对 URL → 相对路径)
- 收集所有引用的资源文件

#### 新增文件

**1. `js/folder-permission-manager.js`** - 文件夹权限管理
- `requestFolderPermission()`: 弹出文件夹选择对话框
- `saveFolderHandle()`: 保存句柄到 IndexedDB
- `getFolderHandle()`: 从 IndexedDB 读取句柄
- `verifyPermission()`: 验证权限是否有效

**2. `js/file-system-writer.js`** - 文件系统读写工具
- `writeTextFile()`: 写入文本文件
- `writeBinaryFile()`: 写入二进制文件(Blob)
- `batchWriteFiles()`: 批量写入文件
- `readTextFile()`: 读取文本文件

**3. `js/offline-site-saver.js`** - 离线站点保存器
- `saveCompleteOfflineSite()`: 主入口,保存完整站点
- `loadMaterialFromFolder()`: 从文件夹加载 material.json
- `generateViewerHtml()`: 生成纯查看版 HTML
- `extractDataUrls()`: 提取 data: URL 并转换为文件

#### 修改的文件

**1. `js/mode-manager.js`**
- 修改 `loadMaterial()`: 优先从授权文件夹加载,回退到 IndexedDB/内嵌 JSON
- 修改 `updateMaterialInMemory()`: 移除自动保存逻辑

**2. `js/editor.js`**
- 修改 `saveAll()`: 集成文件夹保存流程,显示进度
- 新增 `handleSelectFolder()`: 处理文件夹选择
- 新增 `updateFolderStatusDisplay()`: 更新文件夹状态显示
- 修改 `createEditToolbar()`: 添加文件夹相关 UI

**3. `index.html`**
- 引入三个新模块: folder-permission-manager.js, file-system-writer.js, offline-site-saver.js

### UI 改进

**编辑工具栏新增**:
- 文件夹状态显示(显示当前文件夹名称)
- Select Folder 按钮(选择/更换工作文件夹)
- 保存进度显示(0-100%)

### 兼容性处理

- 检查浏览器支持 File System Access API
- 不支持时提示使用 Chrome 86+ 或 Edge 86+
- 保留 Export/Import ZIP 作为备选方案

### 技术亮点

1. **真正的本地持久化**: 不受浏览器存储配额限制,支持大文件
2. **数据 URL 自动提取**: 自动转换 base64 为实际文件
3. **双版本设计**: 编辑版(功能完整) vs 查看版(纯展示)
4. **权限持久化**: 句柄保存在 IndexedDB,自动恢复权限

### 使用说明

**首次使用**:
1. 进入离线编辑模式
2. 点击 "Save All"
3. 选择工作文件夹
4. 等待保存完成

**后续使用**:
1. 重新打开编辑器
2. 自动从文件夹加载
3. 继续编辑
4. Save All 自动更新

**查看保存的站点**:
- 打开文件夹中的 index.html
- 纯查看版,无编辑功能

### 文件变更清单

#### 新增文件
- `js/folder-permission-manager.js`
- `js/file-system-writer.js`
- `js/offline-site-saver.js`

#### 修改的文件
- `js/mode-manager.js`
- `js/editor.js`
- `index.html`

#### 更新的文档
- `Document/Log/v0.6_interactive_enhancements.md`(本文件)

---

## Bug修复 (2026-02-13) - 导出/落盘站点缺失静态资源

### 问题现象
- 生成后的站点目录仅包含 `index.html`、`material.json` 等少量文件，缺少 `css/` 与 `js/`。
- 打开导出页面时样式丢失、区块不渲染，只显示顶部基础文本链接。

### 根因分析
1. 静态资源收集流程依赖 `fetch('./path')` 读取本地资源。
2. 在部分 `file://` 场景中，`fetch` 读取本地文件失败，导致资源被静默跳过。

### 修复方案
- 为离线文件夹保存器新增 `fetch + XHR` 双通道读取：
  - `fetch` 失败时，回退到 `XMLHttpRequest`（接受 `status=0` 的 `file://` 返回）。
- 为 ZIP 打包资源读取增加同样的 XHR 回退，避免导出包缺文件。
- 为文件夹保存新增必需文件校验（`css/styles.css`、`js/templates.js`、`js/section-renderer.js`）：
  - 缺失时直接返回错误并提示用户通过本地 server 运行后再保存。

### 修改文件
- `js/offline-site-saver.js`
- `js/editor.js`

### 后续修复补丁（媒体加载）
- 选择本地文件夹后，虽然 `material.json` 可加载，但 `uploads/*` 媒体仍按当前站点根路径请求，导致图片/视频不显示。
- 已在 `loadMaterialFromFolder()` 增加文件夹媒体内联：自动将相对媒体路径读取为 `data:` URL，再回填到运行时 material。
- 同时修复模板与兼容加载器对 `data:` / `blob:` URL 的识别，避免错误拼接 `imagesBasePath`。

### 追加修改文件
- `js/offline-site-saver.js`
- `js/templates.js`
- `js/material.js`

---

## 功能增强 (2026-02-13) - 按钮文本与 Section/Page ID 可编辑

### 需求
- 编辑模式下，`data-material` 绑定到按钮的文案也应可直接编辑。
- 侧边栏中的 Section（可视作页面块）需要支持直接修改 `id`，而不只是改显示名称。

### 实现方案
1. **按钮文本可编辑**
   - 调整 `enableInlineEditing()` 的元素过滤规则，不再排除 `BUTTON`。
   - 现在所有非 `INPUT/TEXTAREA` 且带 `data-material` 的节点都可进入 `contenteditable` 编辑流程。

2. **Section/Page ID 可编辑**
   - 在编辑侧边栏卡片中新增 `ID: xxx` 展示行（`sidebar-section-id`）。
   - 支持双击该行进入编辑，`Enter` 或失焦提交。
   - 新增 `updateSectionId(oldId, newId)`：
     - 校验新 ID 格式（字母开头，只允许字母/数字/`_`/`-`）。
     - 校验重复 ID。
     - 同步迁移 `material.index[oldId] -> material.index[newId]`。
     - 更新 `material.config.sections` 中对应 section 的 `id`。
     - 触发重新渲染与刷新，确保页面结构和导航联动立即生效。

### 兼容与回退
- 若输入为空、格式非法或与现有 ID 冲突，会提示并回退到原 ID。
- 若输入与旧 ID 相同，不做额外变更。

### 修改文件
- `js/editor.js`
